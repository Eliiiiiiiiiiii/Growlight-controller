# 1.1 Design criteria


| Criteria     | Value             |
| ------------ | ----------------- |
| $Vin_{max}$  | $24V$             |
| $V_{string}$ | $33V$             |
| $Iout_{max}$ | $900mA$           |
| $I_{LED}$    | $150mA\:\&\:60mA$ |
| $ΔVout$      | $< 20mV$          |
| $Fsw$        | $500kHz$          |
 

| Results        | Value                                                 |
| -------------- | ----------------------------------------------------- |
| $Vout_{min}$   | $15.18V$                                              |
| $Vout_{max}$   | $40.9V$                                               |
| $R_{FBT}$      | $665kΩ$                                               |
| $R_{FBB}$      | $57.6kΩ$                                              |
| $V_{UVLO}$     | $10.3V$                                               |
| $R_{UVT}$      | $121kΩ$                                               |
| $R_{UVB}$      | $10kΩ$                                                |
| $R_{SENSE}$    | $40mΩ$                                                |
| $R_{ISENSE}$   | $20mΩ$                                                |
| $nFET$         | BSC0805LS                                             |
| $nFET\:RGD$    | $>1.25Ω$                                              |
| $nFET_{PLOSS}$ | $≤1.06W@500kHz$                                       |
| $pFET$         | SI8487DB-T1-E1                                        |
| $pFET_{PLOSS}$ | $1.815W$                                              |
| $PUMP_{CF}$    | $2.2µF$                                               |
| $PUMP_{COUT}$  | $10µF$                                                |
| $D_{RECT}$     | SP1560L-A                                             |
| $Inductor$     | AAS0660M220F                                          |
| $L$            | $22µH$                                                |
| $Cin$          | $42µF$                                                |
| $Cout$         | $98µF$                                                |
| $BSYNC$        | $PD→Dither$                                           |
| $BFSET$        | $11kΩ→500kHz$                                         |
| $ISET$         | $20.896kΩ,\:52.3kΩ→150mA\lor 60mA$                    |
| $MODE$         | $4.75kΩ→ Hybrid$                                      |
| $PFSET$        | $11kΩ,\: 5.76kΩ,\: 3.92kΩ→2441Hz\lor 610Hz\lor 152Hz$ |
| $LSET$         | $3.92kΩ,\: 11kΩ→6CH\lor 2CH$                          |

# 2.1 Calculations

## 2.2 Feedback divider

To set the desired output voltage range of $Vout_{min}<Vstring_{min}$ and $Vout_{max}>(Vstring_{max}+Vdrop_{max})+2V$, a series of equations must be computed to find suitable R1 and R2 values.

Firstly, the $Vout_{min}$, $Vout_{max}$, $Vout_{UVPmax}$ and $Vout_{OVPmin}$ criteria should be calculated. $Vdrop_{max}$ can be approximated by a 1V drop.

$Vout_{min}<Vstring_{min}\to$ 
$Vout_{min}< 10\cdot2.8V\iff$
$Vout_{min}< 28V$

$Vout_{max}>(Vstring_{max}+Vdrop_{max})+2V\to$ 
$Vout_{max}>((10\cdot 3.3V)+1V)+2V\iff$ 
$Vout_{max}>36V$

$Vout_{UVPmax}>Vstring_{max}+Vdrop_{max}\to$
$Vout_{UVPmax}>(10×3.3V)+1V\iff$
$Vout_{UVPmax}>34V$

$Vout_{OVPmin}<48V$

Once $Vout_{min}$ and $Vout_{max}$ have been found, $Vboost_{min}$, $Vboost_{max}$, $Vboost_{UVPmax}$ and $Vboost_{OVPmin}$ can be found using the equations below. The process of determining suitable RFBT and RFBB resistances is really just experimenting. A sort of intersecting graph could probably also be made but experimenting was deemed the easier option.


$Vboost_{min}=\left(\dfrac{V_{BG}}{R_{FBB}}\right)\cdot R_{FBT} +V_{BG}\to$
$\left(\dfrac{1.21V}{57.6kΩ}\right)\cdot 665kΩ +1.21V=15.18V$

$Vboost_{max}=\left(\dfrac{V_{BG}}{R_{FBB}}+I_{SELmax}\right)\cdot R_{FBT}+V_{BG}\to$
$\left(\dfrac{1.21V}{57.6kΩ}+38.7µA\right)\cdot 665kΩ+1.21V=40.9V$

$Vboost_{UVPmax}=\left(\dfrac{V_{UVP}}{R_{FBB}}+I_{SELmax}\right)\cdot R_{FBT}+V_{UVP}\to$
$\left(\dfrac{0.886V}{57.6kΩ}+38.7µA\right)\cdot 665kΩ+0.886V=36.85V$

$Vboost_{OVPmin}=\left(\dfrac{V_{OVPL}}{R_{FBB}}+0.886\cdot I_{SELmax}\right)\cdot R_{FBT}+V_{OVPL}\to$
$\left(\dfrac{1.423V}{57.6kΩ}+0.886\cdot 38.7µA\right)\cdot 665kΩ+1.423V=40.65V$



## 2.3 UVLO divider

To program the undervoltage threshold, a resistive divider is needed. Its values can be found the two formulas below. They calculate VUVLO rising and VUVLO falling respectively.

$VUVLO_{rising}=\left(\dfrac{R1}{R2}+1\right)\cdot VUVLO_{threshold}$

$VUVLO_{falling}=VUVLO_{rising}-(R1\cdot I_{UVLO})$

Where:
$VUVLO_{threshold}=0.787V$
$I_{UVLO}=5µA$

Ideally the IC should not turn on with an input voltage any lower than 12V so using resistor values already placed, the closest match to this criteria is found.

$VUVLO_{rising}=\left(\dfrac{121kΩ}{10kΩ}+1\right)\cdot 0.787V= 10.3V$

$VUVLO_{falling}=VUVLO_{rising}-(121kΩ\cdot 5µA) =9.7V$


## 2.4 $R_{SENSE}$

The $R_{SENSE}$ resistor determines the boost overcurrent limit and is sensed every boost switching cycle. The datasheet suggests a 20mΩ resistor for a overcurrent limit of roughly 10A. However the $R_{SENSE}$ value can be increased to lower the boost overcurrent limit. It should not be over 50mΩ as this is 4A overcurrent limit. 
The formula below can be used to find the current sense resistor value for any given current limit.

$R_{SENSE}=\dfrac{200mV}{I_{BOOST}OCP}$

Setting a 5A current limit would then yield a 40mΩ current sense resistor.

$\dfrac{200mV}{5A}=40mΩ$

Calculating power losses through this resistor at the current limit gives us 1W dissipation.

$5A²\cdot 0.04Ω=1W$

A suitable resistor is then found. ==RL3720WT-R040-FNH==


## 2.5 $R_{ISENSE}$

A high power resistor can be used for sensing input current. Overcurrent condition is detected when voltage across $R_{ISENSE}$ reaches 220mV. Typically a 20mΩ resistor is used and achieves an 11A overcurrent limit. Can be adjusted based on needs.

Using the formula below, a suitable resistance can be found for any output current limit.

$R_{ISENSE}=\dfrac{220mV}{I_{IN}OCP}$

The suggested resistance is used in this case.

A suitable part is found. ==HoCS1225-3W-20mR-1%-TCR200==


## 2.6 Switching FET

The switching FET is suggested by the datasheet to be an N-channel MOSFET with low gate turn on voltage, low on resistance and low switching losses. RDSON is specifically recommended to be below 20mΩ.
Due to the high switching frequency QRR is of utmost importance to keep losses low.

Taking a reasonable VDS margin into account, a suitable MOSFET can be found by trial and error using [this site](https://www.dmcinfo.com/blog/17021/mosfet-power-loss-calculator/) to compute any estimated power losses in the MOSFET.

The chosen MOSFET is a ==BSC0805LS== due to its high VDS breakdown, low on resistance and exceptionally low switching losses. [BSC0805LS power losses](https://www.dmcinfo.com/blog/17021/mosfet-power-loss-calculator/?v_bus=37&current=3.6&f_sw=500&f_sw_unit=1e3&v_gate_drive=5&rdson=7.7&t_rdson_unit=1e-3&q_g=16&q_g_unit=1e-9&t_d_on=6.5&t_d_on_unit=1e-9&t_rise=3.6&t_rise_unit=1e-9&t_d_off=20&t_d_off_unit=1e-9&t_fall=5.3&t_fall_unit=1e-9&q_rr=12&q_rr_unit=1e-9&v_fv=0.9&c_oss=340&c_oss_unit=1e-12&theta_ja=50&theta_jc=1.5&theta_ca=10&t_amb=25&t_j_limit=150&thermal_mode=ja&project=LP8866+boost+nfet&cs=31a69ccb)

| Switching frequency | Estimated power loss |
| ------------------- | -------------------- |
| $500kHz$            | $1.059W$             |
| $400kHz$            | $0.885W$             |
| $303kHz$            | $0.720W$             |

Furthermore a gate resistor is needed in most cases, as the LP8866S gate driving circuit can at most sink/source 2.5A. 

The datasheet provides two equations to determine what a minimum gate resistance might be if needed.

$\dfrac{VGD}{RDS_{onX}+RGD}<2.5A$

Where $RDS_{onH}$ is the high side gate driver FETs on resistance and $RDS_{onL}$ is the low side gate driver FETs on resistance.

|             | Value   |
| ----------- | ------- |
| $RDS_{onH}$ | $1.4Ω$  |
| $RDS_{onL}$ | $0.75Ω$ |
| $VGD$       | $5V$    |

$\dfrac{5V}{1.4Ω+0.6Ω}=2.5A$

$\dfrac{5V}{0.75Ω+1.25Ω}=2.5A$

Therefore the gate resistance must be at least 1.25Ω.
For now a ==10Ω== is used, but may be subject to change to ensure faster or slower turn-on/off times.


## 2.7 Powerline FET

Powerline FET is suggested by the datasheet to be a P-channel MOSFET with an $R_{DSON}$ of less than 20mΩ. The chosen P-channel MOSFET should be fully turned on seeing the minimum VIN on between gate and source. Gate pullup resistor should be 20kΩ. 

The gate drive voltage is around -7V. (Deduced from pull down current and pull up resistance.)

Due to solution size and two parallel ==SI8487DB== P-channel MOSFETs are used. They each feature an on resistance of about 30mΩ, so roughly 15mΩ total. 

Power losses can be estimated purely from on resistance using $P=I²R$ as the MOSFET is rarely switched on or off. Using the worst case scenario of 11A (as this is the over current limit) you get a power loss of 1.815W.

$11A²\cdot 0.015Ω =1.815W$


## 2.8 Charge pump flying capacitor

Charge pump is to generate the 5V gate drive voltage for switching the external NFET. It is only enabled if VDD is less than 4.5V. In the case of VDD being greater than 4.5V VDD and CPUMP should be tied together. If the charge pump is used it should have a 2.2µF capacitor between pins C1N and C1P.


## 2.9 Charge pump output capacitor

The charge pump output should be decoupled with a 4.7µF or greater capacitor between pin CPUMP and GND. 10µF is used in this application due to already being used in other circuitry.


## 2.10 Rectification diode

The datasheet suggests a schottky diode is to be used as the output rectification diode. The chosen diodes current rating and RVB should be at least 25% greater than respectively maximum output current and maximum output voltage. It should furthermore have a low forward voltage and fast switching speeds.

The chosen part is ==SP1560L-A== with a 15A current rating, 60V breakdown voltage and 0.59Vfwd@15A. ==Datasheet does not state any switching speed  performance so it may be beneficial to explore alternatives.==

Calculating power losses through the diode using boost maximum switch current and diode forward voltage gives us a dissipation of 2.3W.

$3.858A\cdot 0.59V = 2.276W$

The power dissipation is expected to be lower than this as the forward voltage at 4A is significantly lower than at 15A. I guess would be closer to 1W.


## 2.11 Output inductor

To select a suitable output inductor, a few criteria must be considered, namely switching frequency, operating voltage and current rating.

Switching frequency is neatly tied to what inductance should be used according to the table below. 
![[Pasted image 20260112150255.png]]
Due to switching FET losses and solution size, the switching frequency has been limited to between 500kHz and 303kHz. This tells us that inductance should be 22µH.

Next to consider is operating voltage. This is simply to ensure the inductor wires insulation will not break down during normal operation. With a Vout of up to 41V, it is adviseable to let voltage rating be at least 10V higher.

Lastly is current rating. To determine the maximum current seen by the inductor, use the formula below.

$I_{SWmax}=\dfrac{ΔI_{L}}{2}+\dfrac{I_{OUTmax}}{1-D}$

Where:

$ΔI_{L}=\dfrac{Vin_{min}\cdot D}{Fsw\cdot L}$

$D=1-\dfrac{Vin_{min}\cdot\eta}{Vout}$

$\eta=$ Efficiency of boost converter. This can be approximated to 80%.

$Vout = 36.85V$ As this is VBOOSTuvpmax.


Using this formula yields a maximum switching current of 3.86A@500kHz 3.96A@400kHz and 4.12A@303kHz.

$D=1-\dfrac{12V\cdot 80\%}{36.85V}=0.739$


$ΔI_{L}@500kHz=\dfrac{12V\cdot D}{500kHz\cdot 22µH} =0.807A$

$ΔI_{L}@400kHz=\dfrac{12V\cdot D}{400kHz\cdot 22µH} =1.008A$

$ΔI_{L}@303kHz=\dfrac{12V\cdot D}{303kHz\cdot 22µH} =1.331A$


$I_{SWmax}@500kHz=\dfrac{ΔI_{L}@500kHz}{2}+\dfrac{0.9A}{1-D}=3.858A$

$I_{SWmax}@400kHz=\dfrac{ΔI_{L}@400kHz}{2}+\dfrac{0.9A}{1-D}=3.958A$

$I_{SWmax}@303kHz=\dfrac{ΔI_{L}@303kHz}{2}+\dfrac{0.9A}{1-D}=4.12A$

Typically it is a good idea to oversize the current rating as much as reasonably possible to lower losses and heating due to DCR.

The chosen part based on these criteria is the ==AAPS0660M220F==. Its insulation can handle up to 55V, DCR of 60.63mΩ, 5A current rating and 5.6A saturation current. Using the worst case scenario of Fsw = 303kHz, the DCR would incur a roughly 1.03W power loss in the part.


## 2.12 Input capacitance

For input capacitance, the datasheet recommends 50µF or more effective capacitance. Specifically a combination of aluminium polymer capacitors and ceramic capacitors is advised as this can strike a good balance between ensured capacitance even at high DC bias, solution size and ripple current. 
Furthermore the datasheet recommends voltage ratings 50% greater than output voltage.

Input capacitance requirements are however not as stringent as output capacitance requirements so can be relaxed a bit due to other constraints such as solution size.

The total nominal input capacitance is chosen to be ==42µF== consisting of ==2×10µF 50V 0805== ceramic capacitors and one ==22µF 35V 1206== ceramic capacitor. 


## 2.13 Output capacitance

For output capacitance, the datasheet recommends 50µF or more effective capacitance. Specifically a combination of aluminium polymer capacitors and ceramic capacitors is advised as this can strike a good balance between ensured capacitance even at high DC bias, solution size and ripple current. 
Furthermore the datasheet recommends voltage ratings 50% greater than output voltage.

The total nominal output capacitance is chosen to be ==130µF== consisting of ==3×10µF 50V 0805== ceramic capacitors ==HGC0805R5106K500NSLJ== and one ==100µF 50V== aluminium polymer capacitor ==PH101M050E140B000==. Voltage rating is not quite 50% greater than output voltage, but this is due to a compromise between solution size and capacitance.


## 2.14 Strapping pins


### 2.14.1 BSYNC

![[Pasted image 20260104214051.png]]

The implementation should strive to use spread spectrum to minimize EMI.
A pulldown resistor should be placed between pin BSYNC and VDDIO.


### 2.14.2 BFSET

![[Pasted image 20260104203227.png]]

The boost converters switching frequency should seldom be changed, therefore it should just be configured with a single resistor, replaceable with rework at a later date if needed. 
Nominal switching frequency is 500kHz so an 11kΩ resistor should be placed between pin BFSET and GND. 


### 2.14.3 ISET

LED string current can be set either with an external resistor, or using the I2C interface built in to the LP8866. If an external resistor is used, the output current can still be adjusted down from the resistor set nominal current output. 

The ISET resistors resistance for a given current is determined using the formula below.

$I_{LED}=\dfrac{1.21V}{R_{ISET}}\cdot 2580$

$\dfrac{1.21V}{52.3kΩ}\cdot 2580 =59.7mA$

$\dfrac{1.21V}{20.896kΩ}\cdot 2580 =149.4mA$

Using this formula we find that to achieve an LED current of 60mA and 150mA, we need a 52.3kΩ and 20.896kΩ resistor respectively. Having a toggle-able parallel resistor to switch between these two LED currents would be ideal.

![[Pasted image 20260104220019.png]]

If we consider a circuit like above, one should be able to create a circuit in which the resistance seen between Node1 and GND is toggle-able between 52.3kΩ and 20.896kΩ simply by shorting or opening the jumper.

To achieve this a start would be assigning $R_{SET}$ the value of 52.3kΩ. 
Next would be calculating the value of $R_{parallel}$ required to ensure the total resistance from Node1 to GND is 20.896kΩ when the jumper is shorted. 
For this using the formula below should yield the correct resistance needed for $R_{parallel}$.

$R_{parallel}=\dfrac{1}{\dfrac{1}{R_{total}}-\dfrac{1}{R_{SET}}}$

$R_{parallel}=\dfrac{1}{\dfrac{1}{20.896kΩ}-\dfrac{1}{52.3kΩ}}=34.8kΩ$


Therefore if we then subsequently assign $R_{parallel}$ the value of 34.8kΩ we get a toggle-able resistance of 52.3kΩ or 20.896kΩ depending on the state of the jumper.

As previously mentioned, the I2C interface can also adjust the LED current, and this is done according to the formula found below.

$I_{LED}=\left(\dfrac{1.21V}{R_{ISET}}\cdot 2580\right)\cdot\left( \dfrac{LED\_CURRENT[11:0]}{4095} \right)$


### 2.14.4 MODE

![[Pasted image 20260104214440.png]]

Current dimming mode, hybrid mode dimming and phase-shift pwm mode dimming are all valid choices of dimming modes.

Current dimming just varies the current seen by the LEDs depending on input PWM duty cycle.

Hybrid mode dimming utilizes current dimming all the way down to 12.5% LED current, where it then switches to PWM dimming to achieve even better dynamic range than just current dimming. 

Phase shift PWM dimming is essentially just PWM dimming but phase-shifted between each channel to minimize current draw at any given moment, and therefor minimize ripple on the boost converter output voltage.

By default this implementation should be configured to hybrid mode dimming, as this can also be adjusted to purely current dimming using a register. 
Therefore there should be either a 4.75kΩ or a 17.8kΩ resistor between pin MODE and GND.


### 2.14.5 PFSET

![[Pasted image 20260104214420.png]]

Ideal PWM frequency is currently unknown, so it should be easily configurable after assembly. It should be able to use 2441Hz, 610Hz and 152Hz.
As the resistors should be 1% or better tolerance, parallel resistors to save on space is out of the question. Three individual resistors of 11kΩ, 5.76kΩ and 3.92kΩ with jumpers must be used.


### 2.14.6 LSET

![[Pasted image 20260104214010.png]]

To configure how many LED driver channels are to be used, an external resistor is needed. Ideally this implementation should be able to do both 6CH active and 2CH active for testing purposes. Therefore a resistor and a parallel resistor should be used to achieve the two configurations by simply removing or adding a jumper.

First off the highest resistance should be found. In this case that is 11kΩ which configures the IC to use 2 channels. Next off, using the formula below, the required resistance to set the IC to 6 channels is found.

$R_{parallel}=\dfrac{1}{\dfrac{1}{R_{total}}-\dfrac{1}{R_{SET}}}$

The circuit configuration should look like this. ![[Pasted image 20260104220019.png]]

Calculating this, gives us a parallel resistance of 6kΩ.

$R_{parallel}=\dfrac{1}{\dfrac{1}{3.92kΩ}-\dfrac{1}{11kΩ}}=6.09kΩ$


## 2.15 Just for fun

$ΔVout$ estimate based on calculations in Boost power stage whitepaper. Not considering ripple created from output capacitance ESR.

$Cout_{min}=\dfrac{Iout_{MAX}\cdot D}{Fsw \cdot ΔVout}$

Inputting all variables else than $ΔVout$ will yield output ripple at a given output capacitance.

$130µF=\dfrac{0.9A \cdot 0.739}{500kHz \cdot ΔVout} → ΔVout = 0.01V$